####   注意点

- 时间一致？
- 防火墙
- selinux
- 归档模式？
- 密钥验证

#### 模式

- 本地复制
- 远程shell
- 服务器模式
- 列表模式

```shell
Local:  rsync [OPTION...] SRC... [DEST]

Access via remote shell:
    Pull: rsync [OPTION...] [USER@]HOST:SRC... [DEST]
    Push: rsync [OPTION...] SRC... [USER@]HOST:DEST

Access via rsync daemon:
    Pull: rsync [OPTION...] [USER@]HOST::SRC... [DEST]
        rsync [OPTION...] rsync://[USER@]HOST[:PORT]/SRC... [DEST]
    Push: rsync [OPTION...] SRC... [USER@]HOST::DEST
        rsync [OPTION...] SRC... rsync://[USER@]HOST[:PORT]/DEST
```

#### 选项

- -p 复制过程保存权限不变
- -v  显示复制过程
- a 归档模式 复制目录
- z 在传输过程中以压缩方式进行传输
- -e "ssh -p22"
- -r 递归复制



#### local

> rsync [OPTION...] SRC... [DEST]

#### remote shell:

> Pull: rsync [OPTION...] [USER@]HOST:SRC... [DEST]
 
>  Push: rsync [OPTION...] SRC... [USER@]HOST:DEST

#### daemon

/etc/rsyncd.conf

##### 全局参数
- pid file: pid 文件 /var/lock/rsync.pid
- lock file: 锁文件 /var/lock/rsync.lock
- log file: 日志文件 /var/log/rsync.log
- uid：使用什么样的用户运行进程（系统用户）
- gid
- port: 默认873

#### 模块参数
- path: 指定备份目录路径
- use chroot: ？
- max connection: 最大同时连接数量
- read only: false
- write only
- list: false
- auth user: 指定访问模块需要使用的用户名（虚拟用户）
- secrets file: 保存用户名和密码的文件
- hosts allow: 白名单优先匹配，和黑名单是或关系，都不匹配就放过
- hosts deny:
- timeout: 空闲超时时间

#### server

```shell
# 编写conf文件
groupadd  -r rsync
useradd -r -s /sbin/nologin -g rsync rsync
# 注意修改文件夹用户权限
chown rsync.rsync 目标目录

rsync --daemon [--config=/xxxxx]
ss -ntl | grep 873

touch rsync.passwd
vim rsync.passwd
# vuser1:123456
chmod 600 rsync.passwd
```

#### client

> Pull: rsync [OPTION...] [USER@]HOST::SRC [DEST]

> Push: rsync [OPTION...] SRC  [USER@]HOST::DEST

```shell
vim /etc/rsync.passwd && chmod 600 /etc/rsync.passwd
rsync [OPTION...] SRC  [USER@]HOST::DEST --password-file=/etc/rsync.passwd
```

#### 异常
- 日志
- selinux、iptables
- 文件名称、权限



#### 重启
killall rsync
ss -tnl | grep 873

#### service