<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>lib | rnotes</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="icon" href="https://cdn.staticaly.com/gh//tu/main/img/image_20220720_132133.ico">
    <script language="javascript" type="text/javascript" src="/rnotes/js/pgmanor-self.js"></script>
    <meta name="description" content="vdoing博客主题模板">
    <meta name="keywords" content="二丫讲梵,golang,vue,go-web,go-admin,go-ldap-admin">
    <meta name="theme-color" content="#11a8cd">
    <meta name="referrer" content="no-referrer-when-downgrade">
    
    <link rel="preload" href="/rnotes/assets/css/0.styles.b6f582e0.css" as="style"><link rel="preload" href="/rnotes/assets/js/app.d0d5683b.js" as="script"><link rel="preload" href="/rnotes/assets/js/2.9060e935.js" as="script"><link rel="preload" href="/rnotes/assets/js/17.daa9d0c3.js" as="script"><link rel="prefetch" href="/rnotes/assets/js/10.ccb2e8ec.js"><link rel="prefetch" href="/rnotes/assets/js/11.f5243cce.js"><link rel="prefetch" href="/rnotes/assets/js/12.eb47a4f5.js"><link rel="prefetch" href="/rnotes/assets/js/13.c43dd985.js"><link rel="prefetch" href="/rnotes/assets/js/14.0eafa5b2.js"><link rel="prefetch" href="/rnotes/assets/js/15.e578bcdb.js"><link rel="prefetch" href="/rnotes/assets/js/16.fbcbe513.js"><link rel="prefetch" href="/rnotes/assets/js/18.81db6855.js"><link rel="prefetch" href="/rnotes/assets/js/19.ccef3218.js"><link rel="prefetch" href="/rnotes/assets/js/20.d65a4477.js"><link rel="prefetch" href="/rnotes/assets/js/21.25a83464.js"><link rel="prefetch" href="/rnotes/assets/js/22.04880741.js"><link rel="prefetch" href="/rnotes/assets/js/23.46a5422a.js"><link rel="prefetch" href="/rnotes/assets/js/24.36dd859e.js"><link rel="prefetch" href="/rnotes/assets/js/25.bd6b2fcc.js"><link rel="prefetch" href="/rnotes/assets/js/26.53e15e6f.js"><link rel="prefetch" href="/rnotes/assets/js/27.9335743c.js"><link rel="prefetch" href="/rnotes/assets/js/28.70023e96.js"><link rel="prefetch" href="/rnotes/assets/js/29.800ff01a.js"><link rel="prefetch" href="/rnotes/assets/js/3.bdac8f6d.js"><link rel="prefetch" href="/rnotes/assets/js/30.44b6fabb.js"><link rel="prefetch" href="/rnotes/assets/js/31.f4727d76.js"><link rel="prefetch" href="/rnotes/assets/js/32.5efcf0ef.js"><link rel="prefetch" href="/rnotes/assets/js/33.b3cb9c50.js"><link rel="prefetch" href="/rnotes/assets/js/34.bac89949.js"><link rel="prefetch" href="/rnotes/assets/js/35.9d924086.js"><link rel="prefetch" href="/rnotes/assets/js/36.c8f70f74.js"><link rel="prefetch" href="/rnotes/assets/js/37.0c666bd2.js"><link rel="prefetch" href="/rnotes/assets/js/38.6f5fd98c.js"><link rel="prefetch" href="/rnotes/assets/js/39.eaafb4df.js"><link rel="prefetch" href="/rnotes/assets/js/4.4e259541.js"><link rel="prefetch" href="/rnotes/assets/js/40.d851782d.js"><link rel="prefetch" href="/rnotes/assets/js/41.22a48aea.js"><link rel="prefetch" href="/rnotes/assets/js/42.16f95940.js"><link rel="prefetch" href="/rnotes/assets/js/43.009280bf.js"><link rel="prefetch" href="/rnotes/assets/js/44.c9a9663a.js"><link rel="prefetch" href="/rnotes/assets/js/45.67a3b0df.js"><link rel="prefetch" href="/rnotes/assets/js/46.b660bbaa.js"><link rel="prefetch" href="/rnotes/assets/js/47.9dc32bb0.js"><link rel="prefetch" href="/rnotes/assets/js/48.c062b3bf.js"><link rel="prefetch" href="/rnotes/assets/js/49.245a21be.js"><link rel="prefetch" href="/rnotes/assets/js/5.2dbab697.js"><link rel="prefetch" href="/rnotes/assets/js/50.aa267736.js"><link rel="prefetch" href="/rnotes/assets/js/51.41ad17b8.js"><link rel="prefetch" href="/rnotes/assets/js/52.aceb364b.js"><link rel="prefetch" href="/rnotes/assets/js/53.770b50ac.js"><link rel="prefetch" href="/rnotes/assets/js/54.b7be0559.js"><link rel="prefetch" href="/rnotes/assets/js/6.5d3e4707.js"><link rel="prefetch" href="/rnotes/assets/js/7.9d204039.js"><link rel="prefetch" href="/rnotes/assets/js/8.80a25d01.js"><link rel="prefetch" href="/rnotes/assets/js/9.8e5ebd3e.js">
    <link rel="stylesheet" href="/rnotes/assets/css/0.styles.b6f582e0.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/rnotes/" class="home-link router-link-active"><!----> <span class="site-name">rnotes</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <!---->  <ul class="sidebar-links"><li><a href="/rnotes/pages/c036c8/" aria-current="page" class="active sidebar-link">lib</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/rnotes/pages/c1d3f5/" class="sidebar-link">lfs</a></li><li><a href="/rnotes/pages/22d4b0/" class="sidebar-link">inotify</a></li><li><a href="/rnotes/pages/e7b1fe/" class="sidebar-link">rsync</a></li><li><a href="/rnotes/pages/b206c1/" class="sidebar-link">sersync</a></li><li><a href="/rnotes/pages/c6660f/" class="sidebar-link">kind</a></li><li><a href="/rnotes/pages/64e800/" class="sidebar-link">qemu</a></li><li><a href="/rnotes/pages/2bd686/" class="sidebar-link">ubuntu</a></li><li><a href="/rnotes/pages/0dffed/" class="sidebar-link">metric</a></li><li><a href="/rnotes/pages/8e78e5/" class="sidebar-link">git_add</a></li><li><a href="/rnotes/pages/a07067/" class="sidebar-link">download</a></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/rnotes/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/rnotes/tools/#tools" data-v-06225672>tools</a></li></ul> <div class="info" data-v-06225672><!----> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2025-05-02</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">lib<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h4 id="file"><a href="#file" class="header-anchor">#</a> file</h4> <p><a href="http://linux.die.net/man/1/file" target="_blank" rel="noopener noreferrer">http://linux.die.net/man/1/file<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">(</span>base<span class="token punctuation">)</span> lv@lv:rnotes$ <span class="token function">file</span> /lib/i386-linux-gnu/libc-2.27.so 
/lib/i386-linux-gnu/libc-2.27.so: ELF <span class="token number">32</span>-bit LSB shared object, Intel <span class="token number">80386</span>, version <span class="token number">1</span> <span class="token punctuation">(</span>GNU/Linux<span class="token punctuation">)</span>, dynamically linked, interpreter /lib/ld-linux.so.2, BuildID<span class="token punctuation">[</span>sha1<span class="token punctuation">]</span><span class="token operator">=</span>950ee16c67f08465acbfe0bbce1b9993e725ab38, <span class="token keyword">for</span> GNU/Linux <span class="token number">3.2</span>.0, stripped
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="size"><a href="#size" class="header-anchor">#</a> size</h4> <p>获取ELF节的字节长度信息</p> <p><a href="http://linux.die.net/man/1/size" target="_blank" rel="noopener noreferrer">http://linux.die.net/man/1/size<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">(</span>base<span class="token punctuation">)</span> lv@lv:rnotes$ size /lib/i386-linux-gnu/libc-2.27.so 
   text	   data	    bss	    dec	    hex	filename
<span class="token number">1917945</span>	  <span class="token number">11624</span>	  <span class="token number">11116</span>	<span class="token number">1940685</span>	 1d9ccd	/lib/i386-linux-gnu/libc-2.27.so

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="binutils"><a href="#binutils" class="header-anchor">#</a> binutils</h4> <p><a href="https://www.gnu.org/software/binutils/" target="_blank" rel="noopener noreferrer">https://www.gnu.org/software/binutils/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h4 id="ldd"><a href="#ldd" class="header-anchor">#</a> ldd</h4> <p><a href="http://linux.die.net/man/1/ldd" target="_blank" rel="noopener noreferrer">http://linux.die.net/man/1/ldd<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>显示出客户二进制文件启动时需要<strong>静态加载的动态库</strong>的完整列表（即加载时依赖项）</p> <ul><li>ldd无法识别出运行时通过调用dlopen()函数动态加载的动态库。</li> <li>根据ldd手册页的描述，运行某些版本的ldd可能会导致安全问题。<strong>在一些环境中某些版本的ldd可能会尝试执行程序来获取依赖信息</strong>,用更安全的方法代替ldd</li></ul> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>objdump <span class="token parameter variable">-p</span> /usr/bin/gst-inspect-1.0  <span class="token operator">|</span> <span class="token function">grep</span> NEEDED
readelf <span class="token parameter variable">-d</span> /usr/bin/gst-inspect-1.0  <span class="token operator">|</span> <span class="token function">grep</span> NEEDED
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>自己执行递归依赖搜索过程???</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">(</span>base<span class="token punctuation">)</span> lv@lv:rnotes$ ldd /usr/bin/gst-inspect-1.0 
	linux-vdso.so.1 <span class="token punctuation">(</span>0x00007ffec8504000<span class="token punctuation">)</span>
	libgstreamer-1.0.so.0 <span class="token operator">=</span><span class="token operator">&gt;</span> /usr/lib/x86_64-linux-gnu/libgstreamer-1.0.so.0 <span class="token punctuation">(</span>0x00007fc74a60a000<span class="token punctuation">)</span>
	libgobject-2.0.so.0 <span class="token operator">=</span><span class="token operator">&gt;</span> /usr/lib/x86_64-linux-gnu/libgobject-2.0.so.0 <span class="token punctuation">(</span>0x00007fc74a3b6000<span class="token punctuation">)</span>
	libglib-2.0.so.0 <span class="token operator">=</span><span class="token operator">&gt;</span> /usr/lib/x86_64-linux-gnu/libglib-2.0.so.0 <span class="token punctuation">(</span>0x00007fc74a09f000<span class="token punctuation">)</span>
	libc.so.6 <span class="token operator">=</span><span class="token operator">&gt;</span> /lib/x86_64-linux-gnu/libc.so.6 <span class="token punctuation">(</span>0x00007fc749cae000<span class="token punctuation">)</span>
	libgmodule-2.0.so.0 <span class="token operator">=</span><span class="token operator">&gt;</span> /usr/lib/x86_64-linux-gnu/libgmodule-2.0.so.0 <span class="token punctuation">(</span>0x00007fc749aaa000<span class="token punctuation">)</span>
	libm.so.6 <span class="token operator">=</span><span class="token operator">&gt;</span> /lib/x86_64-linux-gnu/libm.so.6 <span class="token punctuation">(</span>0x00007fc74970c000<span class="token punctuation">)</span>
	librt.so.1 <span class="token operator">=</span><span class="token operator">&gt;</span> /lib/x86_64-linux-gnu/librt.so.1 <span class="token punctuation">(</span>0x00007fc749504000<span class="token punctuation">)</span>
	libdl.so.2 <span class="token operator">=</span><span class="token operator">&gt;</span> /lib/x86_64-linux-gnu/libdl.so.2 <span class="token punctuation">(</span>0x00007fc749300000<span class="token punctuation">)</span>
	libpthread.so.0 <span class="token operator">=</span><span class="token operator">&gt;</span> /lib/x86_64-linux-gnu/libpthread.so.0 <span class="token punctuation">(</span>0x00007fc7490e1000<span class="token punctuation">)</span>
	libffi.so.6 <span class="token operator">=</span><span class="token operator">&gt;</span> /usr/lib/x86_64-linux-gnu/libffi.so.6 <span class="token punctuation">(</span>0x00007fc748ed9000<span class="token punctuation">)</span>
	libpcre.so.3 <span class="token operator">=</span><span class="token operator">&gt;</span> /lib/x86_64-linux-gnu/libpcre.so.3 <span class="token punctuation">(</span>0x00007fc748c68000<span class="token punctuation">)</span>
	/lib64/ld-linux-x86-64.so.2 <span class="token punctuation">(</span>0x00007fc74ab50000<span class="token punctuation">)</span>
<span class="token punctuation">(</span>base<span class="token punctuation">)</span> lv@lv:rnotes$ objdump <span class="token parameter variable">-p</span> /usr/bin/gst-inspect-1.0  <span class="token operator">|</span> <span class="token function">grep</span> NEEDED
  NEEDED               libgstreamer-1.0.so.0
  NEEDED               libgobject-2.0.so.0
  NEEDED               libglib-2.0.so.0
  NEEDED               libc.so.6
<span class="token punctuation">(</span>base<span class="token punctuation">)</span> lv@lv:rnotes$ readelf <span class="token parameter variable">-d</span> /usr/bin/gst-inspect-1.0  <span class="token operator">|</span> <span class="token function">grep</span> NEEDED
 0x0000000000000001 <span class="token punctuation">(</span>NEEDED<span class="token punctuation">)</span>             共享库：<span class="token punctuation">[</span>libgstreamer-1.0.so.0<span class="token punctuation">]</span>
 0x0000000000000001 <span class="token punctuation">(</span>NEEDED<span class="token punctuation">)</span>             共享库：<span class="token punctuation">[</span>libgobject-2.0.so.0<span class="token punctuation">]</span>
 0x0000000000000001 <span class="token punctuation">(</span>NEEDED<span class="token punctuation">)</span>             共享库：<span class="token punctuation">[</span>libglib-2.0.so.0<span class="token punctuation">]</span>
 0x0000000000000001 <span class="token punctuation">(</span>NEEDED<span class="token punctuation">)</span>             共享库：<span class="token punctuation">[</span>libc.so.6<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h4 id="nm"><a href="#nm" class="header-anchor">#</a> nm</h4> <p><a href="http://linux.die.net/man/1/nm" target="_blank" rel="noopener noreferrer">http://linux.die.net/man/1/nm<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <ul><li>$ nm &lt;二进制文件路径&gt;：列出二进制文件的<strong>所有符号</strong>.对于共享库而言，不仅会列出导出符号（在.dynamic节中的符号），也会列出其他所有符号。如果你除去了库文件中的某些符号（通过strip命令），那么在不使用参数(-D)调用nm命令时，nm将找不到这些被去除的符号;</li> <li>$ nm-D &lt;二进制文件路径&gt;：只列出<strong>动态节中的符号</strong>（即共享库中导出的或对外可见的符号）;</li> <li>$ nm-C &lt;二进制文件路径&gt;：列出<strong>未经过名称修饰的符号</strong></li> <li>$ nm -D --no-demangle &lt;二进制文件路径&gt;：打印出共享库中名称<strong>修饰后的动态符号</strong>;</li> <li>$ nm -A &lt;库文件路径&gt;/*|grep symbol-name：-A选项会将所有在库中找到的符号名打印出来;</li> <li>$ nm -u &lt;二进制文件路径&gt;：列出库中未定义的符号（这个<strong>库文件本身并不包含该符号</strong>，但期望在运行时加载的其他动态库中提供）;</li></ul> <h4 id="objdump"><a href="#objdump" class="header-anchor">#</a> objdump</h4> <p><a href="http://linux.die.net/man/1/objdump" target="_blank" rel="noopener noreferrer">http://linux.die.net/man/1/objdump<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>1.解析ELF头</p> <p>objdump命令的-f选项可以用来获取目标文件头信息。ELF头提供了大量有用的信息。尤其可以通过ELF头信息快速获取二进制文件类型（目标文件、静态库、动态库和可执行文件）和入口点信息（.text节的起点）</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">(</span>base<span class="token punctuation">)</span> lv@lv:rnotes$ objdump <span class="token parameter variable">-f</span>  /usr/lib/i386-linux-gnu/libcups.so.2 

/usr/lib/i386-linux-gnu/libcups.so.2：     文件格式 elf32-i386
体系结构：i386， 标志 0x00000150：
HAS_SYMS, DYNAMIC, D_PAGED
起始地址 0x0000f420
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>2.列出并查看节信息</p> <p>objdump-h选项用来列出所有二进制文件的节.</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>/usr/lib/i386-linux-gnu/libcups.so.2：     文件格式 elf32-i386

节：
Idx Name          Size      VMA       LMA       File off  Algn
  <span class="token number">0</span> .note.gnu.build-id 00000024  00000114  00000114  00000114  <span class="token number">2</span>**2
                  CONTENTS, ALLOC, LOAD, READONLY, DATA
  <span class="token number">1</span> .gnu.hash     00001304  00000138  00000138  00000138  <span class="token number">2</span>**2
                  CONTENTS, ALLOC, LOAD, READONLY, DATA
  <span class="token number">2</span> .dynsym       00003220  0000143c  0000143c  0000143c  <span class="token number">2</span>**2
                  CONTENTS, ALLOC, LOAD, READONLY, DATA
  <span class="token number">3</span> .dynstr       0000318d  0000465c  0000465c  0000465c  <span class="token number">2</span>**0
                  CONTENTS, ALLOC, LOAD, READONLY, DATA
  <span class="token number">4</span> .gnu.version  00000644  000077ea  000077ea  000077ea  <span class="token number">2</span>**1
                  CONTENTS, ALLOC, LOAD, READONLY, DATA
  <span class="token number">5</span> .gnu.version_r 00000170  00007e30  00007e30  00007e30  <span class="token number">2</span>**2
                  CONTENTS, ALLOC, LOAD, READONLY, DATA
  <span class="token number">6</span> .rel.dyn      00005ed0  00007fa0  00007fa0  00007fa0  <span class="token number">2</span>**2
                  CONTENTS, ALLOC, LOAD, READONLY, DATA
  <span class="token number">7</span> .rel.plt      00000718  0000de70  0000de70  0000de70  <span class="token number">2</span>**2
                  CONTENTS, ALLOC, LOAD, READONLY, DATA
  <span class="token number">8</span> .init         00000023  0000e588  0000e588  0000e588  <span class="token number">2</span>**2
                  CONTENTS, ALLOC, LOAD, READONLY, CODE
  <span class="token number">9</span> .plt          00000e40  0000e5b0  0000e5b0  0000e5b0  <span class="token number">2</span>**4
                  CONTENTS, ALLOC, LOAD, READONLY, CODE
 <span class="token number">10</span> .plt.got      00000028  0000f3f0  0000f3f0  0000f3f0  <span class="token number">2</span>**3
                  CONTENTS, ALLOC, LOAD, READONLY, CODE
 <span class="token number">11</span> .text         0004c224  0000f420  0000f420  0000f420  <span class="token number">2</span>**4
                  CONTENTS, ALLOC, LOAD, READONLY, CODE
 <span class="token number">12</span> .fini         00000014  0005b644  0005b644  0005b644  <span class="token number">2</span>**2
<span class="token punctuation">..</span>.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><ol start="3"><li>列出所有符号</li></ol> <p>objdump -t&lt;二进制文件路径&gt;命令与nm&lt;二进制文件路径&gt;命令的执行结果完全相同</p> <p>4.列出动态符号</p> <p>objdump -T&lt;二进制文件路径&gt;命令与nm -D&lt;二进制文件路径&gt;命令的执行结果完全相同</p> <p>5.查看动态节</p> <p>执行objdump-p&lt;二进制文件路径&gt;命令可以查看动态节信息（以查看DT_RPATH和DT_RUNPATH设置）</p> <p>6.查看重定位节</p> <p>执行objdump-R&lt;二进制文件路径&gt;命令可以查看重定位节的信息</p> <p>7.查看节中的数据</p> <p>执行objdump-s-j&lt;节的名称&gt;&lt;二进制文件路径&gt;命令可以指定某个节，并提供其数据的十六进制转储信息。</p> <p>8.列出并查看段</p> <p>执行objdump -p&lt;二进制文件路径&gt;命令可以查看ELF二进制段的信息。</p> <p>9.反汇编代码</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">(</span>base<span class="token punctuation">)</span> lv@lv:rnotes$ objdump <span class="token parameter variable">-d</span> <span class="token parameter variable">-Mintel</span>  /usr/lib/i386-linux-gnu/libcups.so.2  <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-A</span> <span class="token number">10</span> ebx,0x365
   5b636:	<span class="token number">81</span> c3 e6 <span class="token number">65</span> 03 00    	<span class="token function">add</span>    ebx,0x365e6
   5b63c:	<span class="token number">83</span> ec 08             	sub    esp,0x8
   5b63f:	e8 5c <span class="token number">39</span> fb ff       	call   efa0 <span class="token operator">&lt;</span>__stack_chk_fail@plt<span class="token operator">&gt;</span>

Disassembly of section .fini:

0005b644 <span class="token operator">&lt;</span>_fini@@Base<span class="token operator">&gt;</span>:
   5b644:	<span class="token number">53</span>                   	push   ebx
   5b645:	<span class="token number">83</span> ec 08             	sub    esp,0x8
   5b648:	e8 <span class="token number">73</span> <span class="token number">40</span> fb ff       	call   f6c0 <span class="token operator">&lt;</span>__cxa_finalize@plt+0x2b<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span>
   5b64d:	<span class="token number">81</span> c3 cf <span class="token number">65</span> 03 00    	<span class="token function">add</span>    ebx,0x365cf
   5b653:	<span class="token number">83</span> c4 08             	<span class="token function">add</span>    esp,0x8
   5b656:	5b                   	pop    ebx
   5b657:	c3                   	ret    
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>只有在构建时开启了调试（也就是-g选项）时该选项才能正常使用。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>objdump  <span class="token parameter variable">-d</span> <span class="token parameter variable">-S</span>  <span class="token parameter variable">-Mintel</span>  /usr/lib/i386-linux-gnu/libcups.so.2  <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-A</span> <span class="token number">26</span> <span class="token string">&quot;&lt;sharedlib1Function&gt;&quot;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>在默认情况下，objdump会反汇编所有包含代码的节。但有时你可能只对查看特定节中的代码感兴趣</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">(</span>base<span class="token punctuation">)</span> lv@lv:rnotes$ objdump  <span class="token parameter variable">-d</span> <span class="token parameter variable">-S</span>  <span class="token parameter variable">-Mintel</span> <span class="token parameter variable">-j</span> .fini  /usr/lib/i386-linux-gnu/libcups.so.2 

/usr/lib/i386-linux-gnu/libcups.so.2：     文件格式 elf32-i386


Disassembly of section .fini:

0005b644 <span class="token operator">&lt;</span>_fini@@Base<span class="token operator">&gt;</span>:
   5b644:	<span class="token number">53</span>                   	push   ebx
   5b645:	<span class="token number">83</span> ec 08             	sub    esp,0x8
   5b648:	e8 <span class="token number">73</span> <span class="token number">40</span> fb ff       	call   f6c0 <span class="token operator">&lt;</span>__cxa_finalize@plt+0x2b<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span>
   5b64d:	<span class="token number">81</span> c3 cf <span class="token number">65</span> 03 00    	<span class="token function">add</span>    ebx,0x365cf
   5b653:	<span class="token number">83</span> c4 08             	<span class="token function">add</span>    esp,0x8
   5b656:	5b                   	pop    ebx
   5b657:	c3                   	ret   
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h4 id="readelf"><a href="#readelf" class="header-anchor">#</a> readelf</h4> <p><a href="http://linux.die.net/man/1/readelf" target="_blank" rel="noopener noreferrer">http://linux.die.net/man/1/readelf<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <ul><li>readelf只支持ELF二进制格式。</li> <li>readelf不依赖于二进制文件描述库(http://en.wikipedia.org/wiki/Binary_File_Descriptor_library)，而GNU的所有目标文件解析工具则都依赖于这个库，因此readelf可以独立地提供ELF格式的信息。</li></ul> <p>1.解析ELF头 readelf -h
2.列出并查看节信息 readelf -S
3.列出所有符号 readelf --symbols
4.列出动态符号readelf --dyn-syms
5.查看动态节执行readelf -d命令可以查看动态节的信息（以查看DT_RPATH和DT_RUNPATH设置）
6.查看重定位节执行readelf -r命令可以查看重定位节的信息
8. 列出并查看段执行readelf --segments命令可以显示ELF二进制文件的段信息
9. 检测二进制文件是否包含调试信息readelf命令可以很好地显示出二进制文件中包含的各类调试信息</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>readelf --debug-dump-line
<span class="token punctuation">(</span>base<span class="token punctuation">)</span> lv@lv:rnotes$ readelf --debug-dump<span class="token operator">=</span>line  /usr/lib/i386-linux-gnu/libcups.so.2  <span class="token operator">|</span> <span class="token function">wc</span> <span class="token parameter variable">-l</span>
<span class="token number">0</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="部署阶段工具"><a href="#部署阶段工具" class="header-anchor">#</a> 部署阶段工具</h3> <h4 id="chrpath"><a href="#chrpath" class="header-anchor">#</a> chrpath</h4> <ul><li>可以在DT_RPATH原始字符串长度的范围内对其进行修改,如果DT_RPATH字符串原来就是空的，那么不能使用任何的非空字符串替代原有字段;</li> <li>可以删除原有的DT_RPATH字段;</li> <li>可以将DT_RPATH转换成DT_RUNPATH;</li> <li>用于替代的字符串长度不能超过原本存在的DT_RPATH字符串的长度;</li></ul> <h4 id="patchelf"><a href="#patchelf" class="header-anchor">#</a> patchelf</h4> <p><a href="http://nixos.org/patchelf.html" target="_blank" rel="noopener noreferrer">http://nixos.org/patchelf.html<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>该工具可以设置和修改ELF二进制文件的runpath（DT_RUNPATH字段）</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>patchelf --set-rpath <span class="token operator">&lt;</span>paths<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>executable<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="strip"><a href="#strip" class="header-anchor">#</a> strip</h4> <p><a href="http://linux.die.net/man/1/strip" target="_blank" rel="noopener noreferrer">http://linux.die.net/man/1/strip<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>可以清除所有动态加载过程中不需要的库文件符号</p> <h4 id="ldconfig"><a href="#ldconfig" class="header-anchor">#</a> ldconfig</h4> <p><a href="http://linux.die.net/man/8/ldconfig" target="_blank" rel="noopener noreferrer">http://linux.die.net/man/8/ldconfig<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>可以通过ldconfig缓存指定装载器运行时的库搜索路径。</p> <ul><li>/etc/ld.so.conf文件：包含了一组目录列表，默认会扫描里面的库文件。</li> <li>/etc/ld.so.cache文件：将多个路径作为输入参数传递给ldconfig时，ldconfig会将整个扫描过程中查找到的动态库的文件名以ASCII文本列表的形式写入这个文件。</li></ul> <h3 id="运行时分析工具"><a href="#运行时分析工具" class="header-anchor">#</a> 运行时分析工具</h3> <h4 id="strace"><a href="#strace" class="header-anchor">#</a> strace</h4> <p><a href="http://linux.die.net/man/1/strace" target="_blank" rel="noopener noreferrer">http://linux.die.net/man/1/strace<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>可以用来分析加载时的依赖项</p> <h4 id="addr2line"><a href="#addr2line" class="header-anchor">#</a> addr2line</h4> <p><a href="http://linux.die.net/man/1/addr2line" target="_blank" rel="noopener noreferrer">http://linux.die.net/man/1/addr2line<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>可以将运行时地址转换成地址所对应的源代码文件信息和行号</p> <p>当（且仅当）使用调试模式构建二进制文件（<strong>通过传递-g -O0编译器选项</strong>）时，使用该工具有助于分析程序崩溃信息</p> <h4 id="gdb"><a href="#gdb" class="header-anchor">#</a> gdb</h4> <ul><li>set disassembly-flavor&lt;intel|att&gt;；</li> <li>disassemble&lt;函数名&gt;；</li> <li>/r选项：显示额外的汇编指令的十六进制代码（见图12-32）；</li> <li>/m选项：在汇编指令中插入对应的C/C++代码行。</li></ul> <h3 id="静态库工具"><a href="#静态库工具" class="header-anchor">#</a> 静态库工具</h3> <h4 id="ar"><a href="#ar" class="header-anchor">#</a> ar</h4> <p>1.创建静态库</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>ar-rcs <span class="token operator">&lt;</span>库文件名<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>目标文件列表<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ol start="2"><li>列出静态库目标文件</li></ol> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>ar-t <span class="token operator">&lt;</span>库文件名<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>3.从静态库中删除目标文件</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>ar <span class="token parameter variable">-d</span> <span class="token operator">&lt;</span>库文件名<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>需要删除的目标文件<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>4.将新的目标文件添加到静态库</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>ar <span class="token parameter variable">-r</span> <span class="token operator">&lt;</span>库文件名<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>需要添加的目标文件<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>5.重建目标文件顺序</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>ar-m <span class="token parameter variable">-b</span> <span class="token operator">&lt;</span>静态库中的目标文件，被移动的目标文件会移动到该文件前面<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>库文件名<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>需要移动顺序的目标文件<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="实践"><a href="#实践" class="header-anchor">#</a> 实践</h3> <h4 id="链接过程调试"><a href="#链接过程调试" class="header-anchor">#</a> 链接过程调试</h4> <p>预设置 LD_DEBUG=</p><option><p></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">(</span>base<span class="token punctuation">)</span> lv@lv:rnotes$ <span class="token assign-left variable">LD_DEBUG</span><span class="token operator">=</span>help <span class="token function">cat</span>
Valid options <span class="token keyword">for</span> the LD_DEBUG environment variable are:

  libs        display library search paths
  reloc       display relocation processing
  files       display progress <span class="token keyword">for</span> input <span class="token function">file</span>
  symbols     display symbol table processing
  bindings    display information about symbol binding
  versions    display version dependencies
  scopes      display scope information
  all         all previous options combined
  statistics  display relocation statistics
  unused      determined unused DSOs
  <span class="token builtin class-name">help</span>        display this <span class="token builtin class-name">help</span> message and <span class="token builtin class-name">exit</span>

To direct the debugging output into a <span class="token function">file</span> instead of standard output
a filename can be specified using the LD_DEBUG_OUTPUT environment variable.

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h4 id="确定二进制文件类型"><a href="#确定二进制文件类型" class="header-anchor">#</a> 确定二进制文件类型</h4> <p>file、readelf</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>readelf <span class="token parameter variable">-h</span> <span class="token operator">&lt;</span>bin<span class="token operator">&gt;</span> <span class="token operator">|</span> <span class="token function">grep</span> Type

<span class="token punctuation">(</span>base<span class="token punctuation">)</span> lv@lv:rnotes$ readelf <span class="token parameter variable">-h</span> /bin/cat  <span class="token operator">|</span> <span class="token function">grep</span> 类型
  类型:                              DYN <span class="token punctuation">(</span>共享目标文件<span class="token punctuation">)</span>
<span class="token punctuation">(</span>base<span class="token punctuation">)</span> lv@lv:rnotes$ 

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>EXEC（可执行文件）\ DYN（共享目标文件）\REL（可重定位文件）</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">(</span>base<span class="token punctuation">)</span> lv@lv:rnotes$ objdump <span class="token parameter variable">-f</span> /bin/cat 

/bin/cat：     文件格式 elf64-x86-64
体系结构：i386:x86-64， 标志 0x00000150：
HAS_SYMS, DYNAMIC, D_PAGED
起始地址 0x0000000000002710
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>EXEC_P（可执行文件）\ DYNAMIC（共享目标文件）\ 目标文件不会显示任何类型信息</p> <h4 id="获取可执行文件入口点"><a href="#获取可执行文件入口点" class="header-anchor">#</a> 获取可执行文件入口点</h4> <p>readelf、objdump</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">(</span>base<span class="token punctuation">)</span> lv@lv:rnotes$ readelf <span class="token parameter variable">-h</span> /bin/cat  <span class="token operator">|</span> <span class="token function">grep</span> 入口点地址
  入口点地址：               0x2710

<span class="token punctuation">(</span>base<span class="token punctuation">)</span> lv@lv:rnotes$ objdump <span class="token parameter variable">-f</span> /bin/cat <span class="token operator">|</span> <span class="token function">grep</span>  起始地址
起始地址 0x0000000000002710

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="获取动态库入口点"><a href="#获取动态库入口点" class="header-anchor">#</a> 获取动态库入口点</h4> <p>由于动态库会被映射到客户二进制文件的进程内存映射中去，因此只有在运行时才能获得动态库真正的入口点。</p> <ul><li>在GNU调试器中执行应用程序并加载动态库</li> <li>在main()函数的位置设一个断点即可。无论可执行文件有没有使用调试选项构建，一般都能找到这个符号</li> <li>当程序执行到设置在main()函数位置的断点时，加载进程也已经完成</li> <li>将大量屏幕输出重定向到指定文件中去，然后手动查询。</li></ul> <h4 id="列出符号信息"><a href="#列出符号信息" class="header-anchor">#</a> 列出符号信息</h4> <p>nm、readelf</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 对外可见符号</span>
readelf <span class="token parameter variable">--symbols</span> <span class="token operator">&lt;</span>bin<span class="token operator">&gt;</span>

<span class="token comment"># 导出符号</span>
readelf --dyn-syms <span class="token operator">&lt;</span>bin<span class="token operator">&gt;</span>

<span class="token comment"># 对外可见符号</span>
objdump <span class="token parameter variable">-t</span> <span class="token operator">&lt;</span>bin<span class="token operator">&gt;</span>

<span class="token comment"># 导出符号</span>
objdump <span class="token parameter variable">-T</span> <span class="token operator">&lt;</span>bin<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h4 id="查看节的信息"><a href="#查看节的信息" class="header-anchor">#</a> 查看节的信息</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 所有节</span>
readelf <span class="token parameter variable">-S</span> <span class="token operator">&lt;</span>bin<span class="token operator">&gt;</span>
readelf <span class="token parameter variable">-t</span> <span class="token operator">&lt;</span>bin<span class="token operator">&gt;</span>

<span class="token comment"># 动态节</span>
readelf <span class="token parameter variable">-d</span> <span class="token operator">&lt;</span>bin<span class="token operator">&gt;</span>
objdump <span class="token parameter variable">-p</span> <span class="token operator">&lt;</span>bin<span class="token operator">&gt;</span>

<span class="token comment"># 查看重定位节的信息</span>
readelf <span class="token parameter variable">-r</span> <span class="token operator">&lt;</span>bin<span class="token operator">&gt;</span>
objdump <span class="token parameter variable">-R</span> <span class="token operator">&lt;</span>bin<span class="token operator">&gt;</span>

<span class="token comment"># 数据节</span>
readelf <span class="token parameter variable">-x</span> <span class="token operator">&lt;</span>section name<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>bin<span class="token operator">&gt;</span>
objdump <span class="token parameter variable">-s</span> <span class="token parameter variable">-j</span> <span class="token operator">&lt;</span>section name<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>bin<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>确定动态库类型（PIC或LTR）</p> <p>如果构建动态库时没有使用-fPIC编译器选项，那么在动态库的动态节中会有一个TEXTREL字段；如果使用了-fPIC编译器选项，则动态节中不包含该字段。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># pic_or_ltr.sh</span>
<span class="token keyword">if</span> readelf <span class="token parameter variable">-d</span> <span class="token variable">$1</span> <span class="token operator">|</span> <span class="token function">grep</span> TEXTREL <span class="token operator">&gt;</span> /dev/null<span class="token punctuation">;</span><span class="token punctuation">\</span>
<span class="token keyword">then</span> <span class="token builtin class-name">echo</span> <span class="token string">&quot;LTR&quot;</span><span class="token punctuation">;</span> <span class="token punctuation">\</span>
<span class="token keyword">else</span> <span class="token builtin class-name">echo</span> <span class="token string">&quot;-fPIC&quot;</span><span class="token punctuation">;</span><span class="token keyword">fi</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="段信息"><a href="#段信息" class="header-anchor">#</a> 段信息</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>readelf <span class="token parameter variable">--segments</span> <span class="token operator">&lt;</span>bin<span class="token operator">&gt;</span>
objdump p <span class="token operator">&lt;</span>bin<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="反汇编代码"><a href="#反汇编代码" class="header-anchor">#</a> 反汇编代码</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>objdump <span class="token parameter variable">-d</span> <span class="token operator">&lt;</span>bin<span class="token operator">&gt;</span>
<span class="token comment"># 汇编风格</span>
objdump <span class="token parameter variable">-d</span> <span class="token parameter variable">-M</span> intel <span class="token operator">&lt;</span>bin<span class="token operator">&gt;</span>
<span class="token comment"># 带源代码</span>
objdump <span class="token parameter variable">-d</span> <span class="token parameter variable">-M</span> intel <span class="token parameter variable">-S</span> <span class="token operator">&lt;</span>bin<span class="token operator">&gt;</span>
<span class="token comment"># 指定节</span>
objdump <span class="token parameter variable">-d</span> <span class="token parameter variable">-M</span> intel <span class="token parameter variable">-S</span> <span class="token parameter variable">-j</span> .plt <span class="token operator">&lt;</span>bin<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="是否位调试构建"><a href="#是否位调试构建" class="header-anchor">#</a> 是否位调试构建</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>readelf --debug-dump<span class="token operator">=</span>line <span class="token operator">&lt;</span>bin<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="加载时依赖项"><a href="#加载时依赖项" class="header-anchor">#</a> 加载时依赖项</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>ldd <span class="token operator">&lt;</span>bin<span class="token operator">&gt;</span>

objdump <span class="token parameter variable">-p</span> <span class="token operator">&lt;</span>bin<span class="token operator">&gt;</span> <span class="token operator">|</span> <span class="token function">grep</span> NEEDED
readelf <span class="token parameter variable">-d</span> <span class="token operator">&lt;</span>bin<span class="token operator">&gt;</span> <span class="token operator">|</span> <span class="token function">grep</span> NEEDED
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="查看装载器可以找到的库文件"><a href="#查看装载器可以找到的库文件" class="header-anchor">#</a> 查看装载器可以找到的库文件</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>ldconfig <span class="token parameter variable">-p</span>
ldconfig <span class="token parameter variable">-p</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token operator">&lt;</span>bin<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="查看运行时动态链接的库文件"><a href="#查看运行时动态链接的库文件" class="header-anchor">#</a> 查看运行时动态链接的库文件</h4> <ul><li>strace, open()和mmap()系统调用</li> <li>LD_DEBUG=files</li> <li>/proc/<PID>/maps文件</PID></li></ul> <p>lsof</p> <p><a href="http://linux.die.net/man/8/lsof" target="_blank" rel="noopener noreferrer">http://linux.die.net/man/8/lsof<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>对正在运行中的进程进行分析，并将进程打开的所有文件的列表输出到标准输出流中。</p> <p>这里所谓已打开的文件包括普通文件、目录、块设备文件、字符设备文件、执行中的文本引用(executing text reference)、库文件、流文件和网络文件（Internet socket、NFS文件或UNIX domain socket）。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">lsof</span> <span class="token parameter variable">-p</span> <span class="token variable"><span class="token variable">`</span>pgrep firefox<span class="token variable">`</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>-r选项，那么losf将会以无限循环的方式检查运行中的进程，如果想终止进程执行，则需要输入Ctrl-C。</p> <p>+r选项，那么lsof会在没有侦测到更多打开文件时自动终止。</p> <p>在程序代码中调用**dl_iterate_phdr()**函数，就可以在运行时打印出加载的共享库的完整列表，以及每个库文件的一些额外数据（比如加载库的起始地址）</p> <h4 id="创建和维护静态库"><a href="#创建和维护静态库" class="header-anchor">#</a> 创建和维护静态库</h4> <p>ar</p></option></div></div> <!----> <div class="page-edit"><!----> <!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">2025/05/01, 16:09:52</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><!----> <a href="/rnotes/pages/c1d3f5/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">lfs</div></a></div> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/rnotes/pages/c1d3f5/">lfs</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/rnotes/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/rnotes/pages/19e641/"><div>
            git
            <!----></div></a> <span class="date">05-02</span></dt></dl><dl><dd>02</dd> <dt><a href="/rnotes/pages/c1d3f5/"><div>
            lfs
            <!----></div></a> <span class="date">05-02</span></dt></dl><dl><dd>03</dd> <dt><a href="/rnotes/pages/22d4b0/"><div>
            inotify
            <!----></div></a> <span class="date">05-02</span></dt></dl> <dl><dd></dd> <dt><a href="/rnotes/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><!----> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> <!----></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><!----></div></div>
    <script src="/rnotes/assets/js/app.d0d5683b.js" defer></script><script src="/rnotes/assets/js/2.9060e935.js" defer></script><script src="/rnotes/assets/js/17.daa9d0c3.js" defer></script>
  </body>
</html>
